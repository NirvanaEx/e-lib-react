# Current Stage

- Default login route now lands on the user panel (shared library).
- Shared library lists all files with lock icons for inaccessible items and no download action.
- "My files" renamed to "My uploaded files" and shows lock status based on access.
- Sidebar footer (library switch/storage) pinned to the bottom with a dedicated scroll area for the menu list.
- Uploader is always preserved in file access on approval, and access lists persist across access type changes.
- Auto-refresh now skips `/auth/me` while a temp-password change is required to avoid clearing auth.
- Lock icon now appears when a file is not downloadable either due to access or missing assets; download button is hidden in that case.
- Favorites added in My Library with a dedicated page, API, and migration.
- Requests/My uploaded files sidebar items are shown only when file submission is allowed.
- Lock icon size reduced and aligned in shared/my library tables.
- Trash now lists files, versions, and assets with type-specific restore and permanent delete actions.
- Sidebar scrollbar now aligns with the drawer edge (scroll area expanded, content padding preserved).
- listTrash language handling fixed to avoid TS compile errors.
- Lock icon column now centered with reduced padding in user library tables.
- Lock icon column shifted slightly right for horizontal alignment.
- Versions now require an initial file on creation, and version assets are immutable in the UI; deleting/restoring a version soft-deletes/restores its assets.
- Version creation supports multiple language files (one file per language) in the create form.
- Dashboard requests now support search, column sorting, row-click details with asset downloads, and icon actions; user requests mirror tabs/search/sorting.
- Favorites toggles added to user library tables, with access shown as icons and wider title/category columns.
- Favorite add/remove now shows toast notifications.
- Favorites matching now normalizes IDs when building `isFavorite` in user list responses.
- Shared library favorites now stay highlighted by merging favorite IDs client-side; file tables give more room to title/category by shrinking static columns.
- Submit request form now places the admin comment at the end with distinct styling and uses an icon button for adding extra language files.
- Dashboard files and requests tables now use access icons and wider title/category columns, with tighter widths for static fields; my-library request table follows the same spacing.
- Navbar now prefers a shortened surname + initials display when available; publication request details and history highlight user/admin comments, and user request rows open a details dialog with comments.
- Comment columns removed from request tables; comments remain available in request details dialogs.
- File-related tables now allow wrapping in title/category cells to avoid horizontal scrolling.
- Version restore is now only available via Trash; the file details view no longer shows a restore action for deleted versions.
- `/auth/me` now returns full user details (surname/name/patronymic), so the navbar can render the short "Фамилия И.О." label after refresh.
- User labels now show as `login (Фамилия И.О.)` across admin-facing filters/tables and access lists; wrapped columns now use fixed layout with word wrapping and clipping for long text.
- File-related tables now allocate widths to fixed columns and wrap primary text columns to avoid horizontal scroll bars.
- DataTable headers now wrap instead of truncating, and file-related tables rely on flexible column sizing with wrapping to fit the screen without horizontal scroll.
- DataTable UI reverted to the latest commit state; file-related tables no longer use wrap/layout overrides.
- Trash list now hides assets for deleted versions and shows file title/details in the trash table.
- My Library sidebar now includes a Department files tab with a dedicated endpoint and list view filtered to the user's department scope.
- Fixed listUserFiles filter naming to avoid compile errors when the department files view is enabled.
- Department files now support update requests via a leading update icon, with new/update request type icons shown in user/admin request tables.
- Update requests create new versions on approval, and admin request details include version history for updates.
- My uploaded files now flag updates by other users with a warning icon and a details dialog showing who updated.
- Fixed Russian labels added for request types/department files by using Unicode escapes to avoid encoding issues.
- DataTable now supports fixed layout and per-column wrapping; My Library file tables use fixed column widths with wrapping for long titles/headers.
- Centralized My Library file table column sizing/word-wrap in `fileTableLayout.ts` for easy manual tuning.
- Shared library file table now uses its own layout config; user library tables have per-view layouts.
- Added a single leading status column (no header) that groups favorites/lock/update/warning icons.
- Fixed widths (px) for access, languages, file size, created/updated date, and download columns.
- DataTable now allows per-table container overflow control; file tables use page-level horizontal overflow instead of inner table scrollbars.
- Added per-version title snapshots and history display in dashboard file/request details.
- Users can view/download archived versions when enabled per file; admin access tab includes a toggle (default on).
- Metadata updates now backfill the current version’s archived title/description if missing, so history retains old values.
- Setting a previous version as current now restores its archived title/description when available.
- User file details now show archived versions at the bottom in a collapsed accordion by default.

## Next

- Run the new migration for rejection reasons if not done yet.
- Run the new migration for soft-deleting version assets if not done yet.
- Verify shared library shows locked items correctly and download is disabled.
- Confirm creator access persists after toggling public/restricted in file access settings.
- Verify shared library favorites stay highlighted after refresh.
- Verify the Department files tab loads for users with a department and shows department-scoped files.
- Run the new request type migration and verify update requests flow from Department files into Requests.
